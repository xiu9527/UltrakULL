# 檔案：.github/workflows/build-1.3.1.yml
name: Build UltrakULL 1.3.1

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      # ① 取回全部 tags
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # ② 切到 1.3.1
      - name: Checkout 1.3.1
        run: git checkout 1.3.1

      # ③ 下載公開的 stub.zip（不需要驗證）
      - name: Download stub.zip
        run: |
          wget -O stub.zip \
            https://github.com/xiu9527/UltrakULL/releases/download/v1.3.1/stub.zip
          mkdir -p game/ULTRAKILL_Data/Managed
          unzip stub.zip -d game/ULTRAKILL_Data/Managed

      # ④ 建立 csproj.user，設定 ULTRAKILLPath
      - name: Create csproj.user
        run: |
          cat <<EOF > UltrakULL/UltrakULL.csproj.user
          <?xml version="1.0" encoding="utf-8"?>
          <Project>
            <PropertyGroup>
              <ULTRAKILLPath>${{ github.workspace }}/game</ULTRAKILLPath>
            </PropertyGroup>
          </Project>
          EOF

      # ⑤ 安裝 .NET SDK
      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.x'

      # ⑥ 編譯 Release
      - name: Build Release
        run: dotnet build UltrakULL.sln -c Release

      # ⑦ 上傳編譯好的 DLL
      - name: Upload DLLs
        uses: actions/upload-artifact@v4
        with:
          name: UltrakULL-1.3.1
          path: BepInEx/plugins/UltrakULL/*.dll
